<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Next Train Display</title>
</head>

<body>
    <div id="container"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" ></script>
    <script>

const stationKey={
    "TUM":"屯門"
}
        async function getTrainData() {
            const response = await fetch('https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?line=WRL&sta=ETS');
            // const data = await response.json();
            const data =
            {
                "status": 1,
                "message": "successful",
                "curr_time": "2021-01-15 23:59:41",
                "sys_time": "2021-01-15 23:59:41",
                "isdelay": "N",
                "data": {
                    "WRL-ETS": {
                        "curr_time": "2021-01-15 23:59:41",
                        "sys_time": "2021-01-15 23:59:41",
                        "UP": [
                            {
                                "ttnt": "5",
                                "valid": "Y",
                                "plat": "1",
                                "time": "2021-01-15 23:53:00",
                                "source": "-",
                                "dest": "TUM",
                                "seq": "1"
                            },
                            {
                                "ttnt": "12",
                                "valid": "Y",
                                "plat": "1",
                                "time": "2021-01-16 00:00:00",
                                "source": "-",
                                "dest": "TUM",
                                "seq": "2"
                            },
                            {
                                "ttnt": "17",
                                "valid": "Y",
                                "plat": "1",
                                "time": "2021-01-16 00:05:00",
                                "source": "-",
                                "dest": "TUM",
                                "seq": "3"
                            },
                            {
                                "ttnt": "22",
                                "valid": "Y",
                                "plat": "1",
                                "time": "2021-01-16 00:10:00",
                                "source": "-",
                                "dest": "TUM",
                                "seq": "4"
                            },
                            {
                                "ttnt": "31",
                                "valid": "Y",
                                "plat": "1",
                                "time": "2021-01-16 00:19:00",
                                "source": "-",
                                "dest": "TUM",
                                "seq": "5"
                            }
                        ]
                    }
                }
            };
               
            let wording=`<div class='time'>${new Date().toTimeString().substring(0,5)}</div>`
                data.data["WRL-ETS"]["UP"].map((item,index)=>{
                    let background;
                    if(index%2===0){
                        background="light-time-box"
                    }else{
                        background="dark-time-box"
                    }
                
                    wording+=`<div class="time-box ${background}"> 
                            <div class="destination">${stationKey[item.dest]}</div> 
                            <div class="platform-box">
                                <div class="platform-indicator">${item.plat}</div> 
                                <div class="duration">${duration(item.time)}<span class="minute">分鐘</span></div>
                            </div>
                        </div>`
                })
                
                document.getElementById('container').innerHTML = wording

        }
        getTrainData();

        function duration(arrivalTime){
            const currentMinutes= new Date().getMinutes();
            const arrivalMinutes= arrivalTime.split(" ")[1].split(':')[1]
            const current = parseInt(currentMinutes);
            const arrival = parseInt(arrivalMinutes)
            if(arrival-current>=0){
                return arrival-current
            }else{
                return arrival+60-current
            }
        }

    </script>
</body>

</html>